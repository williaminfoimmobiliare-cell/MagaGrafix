<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#1E90FF" />
  <title>MagaGrafix ‚Äî Gestionale Magazzino</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json?v=3" />
  <link rel="icon" href="icons/icon-192.png" sizes="192x192" />

  <!-- Librerie -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <!-- Stili -->
  <link rel="stylesheet" href="style.css?v=3" />
</head>
<body>
  <div class="wrap">
    <header>
      <h1>MagaGrafix</h1>
      <div id="syncStatus" class="sync-badge">Sync: ‚Äî</div>
    </header>

    <!-- Menu responsive -->
    <nav class="top-actions">
      <button id="menuToggle" class="menu-btn">‚ò∞ Menu</button>
      <div id="menuPanel" class="menu-panel">
        <button id="exportJsonBtn">Esporta JSON</button>
        <button id="exportCsvBtn">Esporta CSV</button>
        <button id="importJsonBtn">Importa JSON</button>
        <input id="jsonFileInput" type="file" accept=".json" style="display:none" />

        <button id="syncNowBtn">Sincronizza ora</button>
        <label class="switch"><input id="autoSyncToggle" type="checkbox"><span>AutoSync 30s</span></label>

        <button id="exportPdfBtn">Esporta PDF</button>
      </div>
    </nav>

    <!-- Alert scorte -->
    <div id="alertLow" class="alertbar hidden"></div>

    <div class="grid">
      <!-- Colonna sinistra -->
      <div>
        <!-- Articoli -->
        <div class="card">
          <h3>1Ô∏è‚É£ Aggiungi o Modifica Articolo</h3>
          <div class="flexcol">
            <input id="sku" placeholder="SKU (es. MGX-001)" />
            <input id="name" placeholder="Nome articolo" />
            <div class="row">
              <input id="position" placeholder="Posizione (es. Scaffale A1)" />
              <input id="stockInit" type="number" min="0" placeholder="Stock iniziale" />
            </div>
            <div class="row">
              <input id="costPrice" type="number" min="0" step="0.01" placeholder="Costo ‚Ç¨/pz" />
              <input id="sellPrice" type="number" min="0" step="0.01" placeholder="Prezzo ‚Ç¨/pz" />
            </div>
            <div class="controls">
              <button id="addItemBtn">Aggiungi / Aggiorna</button>
              <button id="clearItemBtn" class="ghost">Pulisci</button>
            </div>
          </div>
        </div>

        <!-- Transazioni -->
        <div class="card">
          <h3>2Ô∏è‚É£ Registra Transazione</h3>
          <div class="flexcol">
            <select id="txSku"><option value="">-- seleziona SKU --</option></select>
            <div class="row">
              <select id="txType">
                <option value="IN">IN (entrata)</option>
                <option value="OUT">OUT (vendita)</option>
                <option value="ROTTURA">ROTTURA (difetto)</option>
              </select>
              <input id="txQty" type="number" min="1" value="1" />
            </div>
            <input id="txSellPrice" type="number" step="0.01" placeholder="Prezzo vendita (solo OUT)" />
            <div class="controls">
              <button id="addTxBtn">Registra</button>
              <button id="clearTxBtn" class="ghost">Pulisci</button>
            </div>
          </div>
        </div>

        <!-- Inventario -->
        <div class="card">
          <div class="flex-between">
            <h3>Inventario</h3>
            <div class="small">Stock / Valore</div>
          </div>
          <input id="inventorySearch" placeholder="üîé Cerca SKU, nome o posizione" style="margin:8px 0 10px" />
          <div class="scroll-area" style="max-height:300px;">
            <table id="inventoryTable">
              <thead>
                <tr>
                  <th>SKU</th><th>Nome</th><th>Posizione</th><th>Stock</th><th>Costo</th><th>Valore</th><th>Azioni</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Colonna destra -->
      <div>
        <!-- Grafico -->
        <div class="card">
          <div class="flex-between">
            <h3>Andamento Magazzino</h3>
            <div class="small">Unit√† totali nel tempo</div>
          </div>
          <div class="row" style="margin:10px 0;">
            <input type="date" id="fromDate" />
            <input type="date" id="toDate" />
            <button id="filterChartBtn">Filtra</button>
            <button id="downloadChartBtn" class="ghost">Scarica periodo</button>
          </div>
          <div class="chartwrap"><canvas id="trendChart"></canvas></div>
        </div>

        <!-- Torta -->
        <div class="card">
          <h3>Panoramica Entrate / Uscite / Guadagno</h3>
          <div class="chartwrap"><canvas id="pieChart"></canvas></div>
        </div>

        <!-- Storico -->
        <div class="card">
          <h3>Storico Transazioni</h3>
          <div class="scroll-area" style="max-height:250px;">
            <table id="transactionsTable">
              <thead>
                <tr>
                  <th>Data</th><th>SKU</th><th>Tipo</th><th>Q.t√†</th><th>Prezzo</th><th>Confermata</th><th>Azioni</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Logo & Azienda -->
        <div class="card">
          <h3>Logo & Azienda</h3>
          <div class="flexcol">
            <input id="companyName" placeholder="Nome azienda (es. MagaGrafix di Falzone William)" />
            <div class="row">
              <input id="logoFile" type="file" accept="image/*" />
              <button id="removeLogoBtn" class="ghost">Rimuovi logo</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="small">¬© 2025 MagaGrafix ‚Äî Gestionale</footer>
  </div>

  <!-- Script applicazione (con versione per aggiornamenti) -->
  <script src="script.js?v=3"></script>
</body>
</html>
